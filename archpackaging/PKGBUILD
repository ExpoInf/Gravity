# Maintainer: ExpoInf | uoonite@gmail.com
pkgname=gravity
_pkgname=Gravity
pkgver=0.0.4.r0.gabcdef
pkgrel=1
pkgdesc="A clean and simple Rust code editor"
arch=('x86_64')
url="https://github.com/ExpoInf/Gravity"
license=('MIT')
depends=('gcc-libs' 'glibc')
makedepends=('cargo' 'git')
provides=("gravity")
conflicts=("gravity")
source=("git+https://github.com/ExpoInf/Gravity.git#branch=main"
        "gravity.desktop")
sha256sums=('SKIP'
            'SKIP')

pkgver() {
    cd "$srcdir/$_pkgname"
    printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

prepare() {
    cd "$srcdir/$_pkgname"
    cargo fetch --locked --target "$CARCH-unknown-linux-gnu"
}

build() {
    cd "$srcdir/$_pkgname"
    cargo build --release --frozen --offline
}

package() {
    cd "$srcdir/$_pkgname"

    install -Dm755 "target/release/$_pkgname" "$pkgdir/usr/bin/gravity"

    install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"

    cd "$srcdir"
    install -Dm644 gravity.desktop "$pkgdir/usr/share/applications/gravity.desktop"
}